<!DOCTYPE html>
<html>
    <head>
        <title>yolo</title>
        <meta charset="UTF-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    </head>
    <body>
        <div id="log">yolo</div>
        <script src="./js/FileSaver.min.js"></script>

        <script>

            var oReq = new XMLHttpRequest()
            oReq.addEventListener("load", function () {
                var doc = oReq.responseXML
                doc.nsResolver = doc.createNSResolver(doc.ownerDocument == null ? doc.documentElement : doc.ownerDocument.documentElement)

                doc.changeOneValue = function (query, val) {
                    var xpathResult = this.evaluate(query, this, this.nsResolver, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE)
                    if (1 !== xpathResult.snapshotLength) {
                        throw new Error("No result found for " + query)
                    }
                    var node = xpathResult.snapshotItem(0)
                    node.value = val
                }

                doc.changeOneTextContent = function (query, val) {
                    doc.changeMultipleTextContent(query, [val])
                }

                doc.changeMultipleTextContent = function (query, val) {
                    var xpathResult = this.evaluate(query, this, this.nsResolver, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE)
                    if (val.length !== xpathResult.snapshotLength) {
                        throw new Error("Mismatch length result found for " + query)
                    }
                    for (var k = 0; k < xpathResult.snapshotLength; k++) {
                        var node = xpathResult.snapshotItem(k)
                        node.textContent = val[k]
                    }
                }

                doc.changeInkscapeTextById = function (id, val) {
                    if (!Array.isArray(val)) {
                        val = [val]
                    }
                    this.changeMultipleTextContent('//*[namespace-uri()="http://www.w3.org/2000/svg" and name()="text" and @id="'
                            + id
                            + '"]/*[name()="tspan"]', val)
                }

                // showing form filling
                doc.changeOneValue('//*[namespace-uri()="http://www.w3.org/2000/svg" and name()="g" and @inkscape:label="remplissage" and @inkscape:groupmode="layer"]/@style', "display:inline")
                // changing name
                doc.changeInkscapeTextById('bk-nom', "Yolo")
                // attributes
                doc.changeInkscapeTextById('bk-attributs', [7, 7, 7, '', 7])

                var skill = []
                skill[0] = 666
                skill[24] = 777
                doc.changeInkscapeTextById('bk-competences', skill)

                var s = new XMLSerializer()
                var blob = new File([s.serializeToString(doc)], 'fdp.svg', {type: "image/svg+xml;charset=utf-8"})
                saveAs(blob)
            })

            oReq.open("GET", "./data/template.svg")
            oReq.send()

        </script>
    </body>
</html>
